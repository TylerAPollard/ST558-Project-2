---
title: "ST558 - Project 2"
author: "Tyler Pollard & Lucy Yin"
output: 
 html_document:
   toc: true
   toc_depth: 3
params: 
      weekday: monday
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, eval = TRUE, message = FALSE, warning = FALSE)
```
# Required Packages
```{r packages}
library(tidyverse)
library(dplyr)
library(knitr)
library(ggplot2)
library(caret)
```

# Introduction (lucy)
  
# Data (lucy)
```{r data - read in}
# read in data
hour.data <- read_csv("data/hour.csv") %>% as_tibble()
day.data <- read_csv("data/day.csv") %>% as_tibble()
```

```{r data - change type}
# correct the variaable types
hour.data$season <- factor(hour.data$season)
levels(hour.data$season) <- list(winter = 1, spring = 2, summer = 3, fall = 4)
hour.data$yr <- factor(hour.data$yr)
levels(hour.data$yr) <- list("2011" = 0, "2012" = 1)
hour.data$mnth <- factor(hour.data$mnth)
hour.data$hr <- factor(hour.data$hr)
hour.data$holiday <- factor(hour.data$holiday)
hour.data$weekday <- factor(hour.data$weekday)
levels(hour.data$weekday) <- list(monday = 1, tuesday = 2, wednesday = 3, thursday = 4, friday = 5, saturday = 6, sunday = 0)
hour.data$workingday <- factor(hour.data$workingday)
hour.data$weathersit <- factor(hour.data$weathersit)

day.data$season <- factor(day.data$season)
levels(day.data$season) <- list(winter = 1, spring = 2, summer = 3, fall = 4)
day.data$yr <- factor(day.data$yr)
levels(day.data$yr) <- list("2011" = 0, "2012" = 1)
day.data$mnth <- factor(day.data$mnth)
day.data$holiday <- factor(day.data$holiday)
day.data$weekday <- factor(day.data$weekday)
levels(day.data$weekday) <- list(monday = 1, tuesday = 2, wednesday = 3, thursday = 4, friday = 5, saturday = 6, sunday = 0)
day.data$workingday <- factor(day.data$workingday)
day.data$weathersit <- factor(day.data$weathersit)
```

```{r data - create total data}
# add in a new variable before merging
hour.data <- mutate(hour.data, type = "hour")
day.data <- mutate(day.data, type = "day", hr = NA) %>% select(instant, dteday, season, yr, mnth, hr, everything())

# merge to create complete list of hour/day data
total.data <- rbind(hour.data, day.data)
```

```{r data - filter parameter}
# filter out to one specific day of the week
hour.data <- hour.data %>% filter(weekday == params$weekday)
day.data <- day.data %>% filter(weekday == params$weekday)
total.data <- total.data %>% filter(weekday == params$weekday)
```

```{r data - split training/test}
# splitting data into training & test sets
set.seed(7)
train <- sample(1:nrow(day.data), size = nrow(day.data)*0.7)
test <- dplyr::setdiff(1:nrow(day.data), train)
day.training.data <- day.data[train, ]
day.test.data <- day.data[test, ]

hour.training.data <- hour.data[hour.data$dteday %in% day.training.data$dteday,]
hour.test.data <- hour.data[hour.data$dteday %in% day.test.data$dteday,]
```

# Summarization (both)
## Contingency Tables
### Weather Situation
```{r contigency table - weathersit}
#levels(day.data$weathersit) <- list("1" = "1", "2" = "2", "3" = "3", "4" = "4")
levels(day.training.data$weathersit) <- list(
  "Clear, Few clouds, Partly cloudy, Partly cloudy" = "1",
  "Mist + Cloudy, Mist + Broken clouds, Mist + Few clouds, Mist" = "2",
  "Light Snow, Light Rain + Thunderstorm + Scattered clouds, Light Rain + Scattered clouds" = "3",
  "Heavy Rain + Ice Pallets + Thunderstorm + Mist, Snow + Fog" = "4")
kable(t(table(day.training.data$weathersit)))
```

## Summary Tables
### Adjusted Temperature
```{r summary table - atemp}
tmin = -16
tmax = 50
day.training.data$atemp_unnormal <- day.training.data$atemp*(tmax - tmin) + tmin # Unnormalize temps
day.training.data$atemp_F <- day.training.data$atemp_unnormal*(9/5) + 32 # Convert to farenheit
atemp_summary <- day.training.data %>% group_by(yr) %>% summarise(mean = mean(atemp_F), sd = sd(atemp_F), min = min(atemp_F), Q1 = quantile(atemp_F,0.25), median = median(atemp_F), Q3 = quantile(atemp_F, 0.75), max = max(atemp_F))
kable(atemp_summary, digits = 2)
```

## Boxplots
### Adjusted temperature over the year
```{r boxplot- adjusted temperature}
atemp_boxplot_df <- day.training.data
levels(atemp_boxplot_df$mnth) <- list(January = 1, February = 2, March = 3, April = 4, May = 5, June = 6, July = 7, August = 8, September = 9, October = 10, November = 11, December = 12)
ggplot(data = atemp_boxplot_df, aes(x = mnth, y = atemp_F)) + 
  geom_boxplot() + 
  geom_point(position = "jitter", color = "blue") + 
  labs(title = "Adjusted temperature distribution per month", x = "Month", y = "Adjusted Temperature (F)")
```

## Scatter Plots
### Adjusted Temperature Drivers


# Modeling
## Linear Regression Model
### What is Linear Regression Model (tyler)
  
### Linear Regression Model (tyler)

### Linear Regression Model (lucy)
  
  
## Ensemble Tree Model
### Random Forest Model (tyler)

### Boosted Tree Model (lucy)
  
  
  
# Comparison (either)
